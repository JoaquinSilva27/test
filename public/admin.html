<!-- public/admin.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administración</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <script>
        // Función autoejecutable para verificar si el usuario es administrador
        (async () => {
          try {
            // Solicitud al servidor para verificar la sesión y el rol
            const response = await fetch("/auth/verify-session");
            const data = await response.json();
    
            if (!data.success || data.user.rol !== "admin") {
                alert("Acceso Denegado")
                window.location.href = "/user.html";
            }
          } catch (error) {
            alert(error)
            console.error("Error verificando la sesión:", error);
            // En caso de error, redirige al login
            window.location.href = "/login.html";
          }
        })();
      </script>
      <script>
        // Función para verificar el estado de la sesión cada minuto
        setInterval(async () => {
          try {
            const response = await fetch("/auth/check-session");
            const data = await response.json();
      
            if (!data.success) {
              // Si la sesión ha expirado, muestra una alerta y redirige al login
              alert(data.message);
              window.location.href = "/login.html";
            }
          } catch (error) {
            console.error("Error verificando la sesión:", error);
          }
        }, 600000); // 60000 ms = 1 minuto
      </script>
</head>
<body>
  <!-- Sidebar Container -->
  <div id="sidebar-container" class="sidebar">
    <header class="sidebar-header">MENU
    </header>
    <nav>
      <a href="#">Te</a>
      <a href="#">La</a>
      <a href="#">Dedico</a>
      <a href="#">Carla</a>
      <a href="#">G</a>
    </nav>
  </div>

  <!-- Main Content Container -->
  <div id="content-container" class="main-content">
    <header class="main-header">
      <div class="logo-menu">
        <span class="icon-menu" onclick="toggleSidebar()">☰</span>
          <h2 class="logo">Riego Maule Sur</h2>
      </div>
      <nav class="navegacion">
        <a href="index.html">Inicio</a>
        <button class="btnLogin-popup" onclick="window.location.href='login.html';">Cerrar Sesion</button>
      </nav>
    </header>
    <div class="mensaje-inicio">
      <h2>¡Bienvenido/a {nombre_usuario}!</h2>
    </div>
  </div>
  <script src="js/admin.js"></script>
  <script src="js/sidebar.js"></script>
</body>
</html>
